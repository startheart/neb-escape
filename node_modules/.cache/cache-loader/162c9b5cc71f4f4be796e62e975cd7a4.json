{"remainingRequest":"/Users/xuguodong/didi/develop/btc/neb/neb-escape/node_modules/babel-loader/lib/index.js!/Users/xuguodong/didi/develop/btc/neb/neb-escape/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/xuguodong/didi/develop/btc/neb/neb-escape/src/components/Escape.vue?vue&type=script&lang=js","dependencies":[{"path":"/Users/xuguodong/didi/develop/btc/neb/neb-escape/src/components/Escape.vue","mtime":1528037935000},{"path":"/Users/xuguodong/didi/develop/btc/neb/neb-escape/node_modules/cache-loader/dist/cjs.js","mtime":1528031134000},{"path":"/Users/xuguodong/didi/develop/btc/neb/neb-escape/node_modules/babel-loader/lib/index.js","mtime":1526583314000},{"path":"/Users/xuguodong/didi/develop/btc/neb/neb-escape/node_modules/vue-loader/lib/index.js","mtime":1526676097000}],"contextDependencies":[],"result":["import \"core-js/modules/es6.array.fill\";\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n/* eslint-disable no-undef */\nimport Form from '@/components/Form.vue';\nexport default {\n  props: {\n    msg: String\n  },\n  data: function data() {\n    return {\n      showForm: false\n    };\n  },\n  mounted: function mounted() {\n    this.init();\n  },\n  created: function created() {// window.addEventListener('load', this.init.bind(this))\n  },\n  methods: {\n    init: function init() {\n      var _this = this;\n\n      this.getAccountInfo().then(function (res) {\n        return _this.fetchLevel(res);\n      }).then(function (res) {\n        console.log('getAccountInfo res: ', res);\n        var level = res.level;\n\n        _this.initGame(level);\n      }).catch(function (err) {\n        console.error('error:', err);\n      });\n    },\n    getAccountInfo: function getAccountInfo() {\n      var addr = this.getAddress();\n\n      if (!addr) {\n        return this.callForm();\n      } else {\n        return Promise.resolve(addr);\n      }\n    },\n    callForm: function callForm() {\n      var _this2 = this;\n\n      return new Promise(function (resolve, reject) {\n        _this2.showForm = true;\n        debugger;\n\n        _this2.$on('callFormSuss', function (res) {\n          debugger;\n          var addr = res.address;\n\n          if (addr) {\n            _this2.setAccount(addr);\n\n            _this2.showForm = false;\n            resolve(addr);\n          } else {\n            reject(res);\n          }\n        });\n      });\n    },\n    onFormSubmit: function onFormSubmit(res) {\n      this.$emit('callFormSuss', res);\n    },\n    fetchLevel: function fetchLevel(addr) {\n      // 获取链上数据\n      var from = addr;\n      var callArgs = [];\n      var opt = {\n        from: from,\n        to: DappAddress,\n        value: 0,\n        nonce: 0,\n        gasPrice: 1000000,\n        gasLimit: 2000000,\n        contract: {\n          function: 'get',\n          args: JSON.stringify(callArgs)\n        }\n      };\n      return neb.api.call(opt).then(function (res) {\n        var result = res.result; // res is an object, res.result is a JSON string\n\n        console.log('return of rpc call: ' + JSON.stringify(result));\n\n        if (result === 'null') {\n          return null;\n        } else {\n          // if result is not null, then it should be \"return value\" or \"error message\"\n          try {\n            result = JSON.parse(result);\n          } catch (err) {// result is the error message\n          }\n\n          if (!!result.level) {\n            // \"return value\"\n            return result;\n          } else {\n            // \"error message\"\n            return null;\n          }\n        }\n      }).catch(function (err) {\n        console.error('error:' + err.message);\n      });\n    },\n    initGame: function initGame(level) {\n      var _this3 = this;\n\n      this.gamejs = window.gamejs;\n      this.gamejs.ready(function () {\n        var self = _this3;\n\n        var display = _this3.gamejs.display.setMode([800, 600]); //Ensure that all required files are included\n\n\n        include_once(['lib/startMenu.js']);\n\n        var mainSurface = _this3.gamejs.display.getSurface();\n\n        var mainWindow = new startMenu(level); // msDuration = time since last tick() call\n\n        var tick = function tick(msDuration) {\n          mainSurface.fill(\"#FFFFFF\"); //Handle user input\n\n          mainWindow.handleInput(mainSurface); //Update the worlds objects\n\n          mainWindow.update(msDuration); //Draw the new objects\n\n          mainWindow.draw(mainSurface);\n        }; //Set up listeners for the body when a scorecard is present\n\n\n        $('body').keydown(function (event) {\n          //Only check key presses if the scorcard is shown\n          if ($('#game_scorecard').is(\":visible\")) {\n            switch (event.keyCode) {\n              //Enter and e will all move to the next level\n              case 13:\n              case 69:\n                $('#game_scorecard .nextLevel').click();\n                event.preventDefault();\n                break;\n              //Escape will quit to the menu\n\n              case 27:\n                $('#game_scorecard .mainMenu').click();\n                event.preventDefault();\n                break;\n              //r will reset the level\n\n              case 82:\n                $('#game_scorecard .resetLevel').click();\n                event.preventDefault();\n                break;\n            }\n          }\n        }); //Remove the loading bar\n\n        $('#preload').remove();\n        $('#gameWindow').show(); //Set up the tick function, run at 60fps\n\n        _this3.gamejs.time.fpsCallback(tick, self, 60);\n      });\n    },\n    getAddress: function getAddress() {\n      var addr = this.address || localStorage.getItem('neb_account_addr');\n\n      if (!Account.isValidAddress(addr)) {\n        return null;\n      } else {\n        return addr;\n      }\n    },\n    setAccount: function setAccount(addr) {\n      if (!Account.isValidAddress(addr)) {\n        return false;\n      }\n\n      this.account = Account.fromAddress(addr);\n      this.address = this.account.getAddressString();\n      localStorage.setItem('neb_account_addr', this.address);\n      return this.account;\n    }\n  },\n  components: {\n    Form: Form\n  }\n};",{"version":3,"sources":["Escape.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\n  <div class=\"escape\">\n    <div>\n      <div id=\"preload\">\n          <img src=\"img/loading.gif\" />\n          <img src=\"img/loading-text.png\" />\n      </div>\n      <div id=\"gameWindow\">\n          <canvas id=\"gjs-canvas\"></canvas>\n          <div id=\"gameEnd\"></div>\n      </div>\n    </div>\n    <Form :dialogFormVisible=\"showForm\" @onSubmitSuccess=\"onFormSubmit\"/>\n  </div>\n</template>\n\n<script>\n/* eslint-disable no-undef */\nimport Form from '@/components/Form.vue'\n\nexport default {\n  props: {\n    msg: String\n  },\n  data() {\n    return {\n      showForm: false\n    }\n  },\n  mounted () {\n    this.init()\n  },\n  created () {\n    // window.addEventListener('load', this.init.bind(this))\n  },\n  methods: {\n    init: function () {\n        this.getAccountInfo().then(res => {\n          return this.fetchLevel(res)\n        }).then(res => {\n            console.log('getAccountInfo res: ', res)\n\n            var level = res.level\n            this.initGame(level)\n\n        }).catch(err => {\n            console.error('error:', err)\n        })\n    },\n    getAccountInfo: function() {\n\n        let addr = this.getAddress()\n\n        if (!addr) {\n          return this.callForm()\n        } else {\n          return Promise.resolve(addr)\n        }\n    },\n    callForm: function() {\n      return new Promise((resolve, reject) => {\n        this.showForm = true\n        debugger\n        this.$on('callFormSuss', (res) => {\n          debugger\n          let addr = res.address\n          if (addr) {\n            this.setAccount(addr)\n            this.showForm = false\n\n            resolve(addr)\n          } else {\n            reject(res)\n          }\n        })\n      });\n    },\n    onFormSubmit: function(res) {\n      this.$emit('callFormSuss', res)\n    },\n    fetchLevel: function(addr) {\n              // 获取链上数据\n      var from = addr\n      var callArgs = []\n\n      var opt = {\n          from: from,\n          to: DappAddress,\n          value: 0,\n          nonce: 0,\n          gasPrice: 1000000,\n          gasLimit: 2000000,\n          contract: {\n            function: 'get',\n            args: JSON.stringify(callArgs)\n          }\n      }\n\n      return neb.api.call(opt).then((res) => {\n          var result = res.result\n          // res is an object, res.result is a JSON string\n          console.log('return of rpc call: ' + JSON.stringify(result))\n\n          if (result === 'null') {\n            return null\n          } else {\n            // if result is not null, then it should be \"return value\" or \"error message\"\n            try {\n              result = JSON.parse(result)\n            } catch (err) {\n              // result is the error message\n            }\n\n            if (!!result.level) {\n            // \"return value\"\n              return result\n            } else {\n            // \"error message\"\n              return null\n            }\n          }\n        }).catch((err) => {\n          console.error('error:' + err.message)\n        })\n    },\n    initGame: function(level) {\n      this.gamejs = window.gamejs\n      this.gamejs.ready(() => {\n\n        var self        = this;\n\n        var display = this.gamejs.display.setMode([800, 600]);\n\n        //Ensure that all required files are included\n        include_once([\n            'lib/startMenu.js'\n        ]);\n\n        var mainSurface = this.gamejs.display.getSurface();\n        var mainWindow  = new startMenu(level);\n\n        // msDuration = time since last tick() call\n        var tick = function(msDuration){\n            mainSurface.fill(\"#FFFFFF\");\n\n            //Handle user input\n            mainWindow.handleInput( mainSurface );\n\n            //Update the worlds objects\n            mainWindow.update( msDuration );\n\n            //Draw the new objects\n            mainWindow.draw( mainSurface );\n        };\n\n        //Set up listeners for the body when a scorecard is present\n        $('body').keydown(function(event){\n            //Only check key presses if the scorcard is shown\n            if ( $('#game_scorecard').is(\":visible\") )\n            {\n                switch ( event.keyCode )\n                {\n                    //Enter and e will all move to the next level\n                    case 13:\n                    case 69:\n                        $('#game_scorecard .nextLevel').click();\n                        event.preventDefault();\n                        break;\n                    //Escape will quit to the menu\n                    case 27:\n                        $('#game_scorecard .mainMenu').click();\n                        event.preventDefault();\n                        break;\n                    //r will reset the level\n                    case 82:\n                        $('#game_scorecard .resetLevel').click();\n                        event.preventDefault();\n                        break;\n                }\n            }\n        });\n\n        //Remove the loading bar\n        $('#preload').remove();\n        $('#gameWindow').show();\n\n        //Set up the tick function, run at 60fps\n        this.gamejs.time.fpsCallback(tick, self, 60);\n      })\n    },\n    getAddress: function () {\n       let addr = this.address || localStorage.getItem('neb_account_addr')\n\n       if (!Account.isValidAddress(addr)) {\n         return null\n       } else {\n         return addr\n       }\n    },\n    setAccount: function (addr) {\n      if (!Account.isValidAddress(addr)) {\n        return false\n      }\n\n      this.account = Account.fromAddress(addr)\n      this.address = this.account.getAddressString()\n\n      localStorage.setItem('neb_account_addr', this.address)\n\n      return this.account\n    }\n  },\n  components: {\n    Form\n  }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped lang=\"stylus\">\n\n</style>\n"],"sourceRoot":"src/components"}]}